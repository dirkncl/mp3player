ID3v2={parseStream:function(n,r){var l={0:"Other",1:"32x32 pixels 'file icon' (PNG only)",2:"Other file icon",3:"Cover (front)",4:"Cover (back)",5:"Leaflet page",6:"Media (e.g. lable side of CD)",7:"Lead artist/lead performer/soloist",8:"Artist/performer",9:"Conductor",A:"Band/Orchestra",B:"Composer",C:"Lyricist/text writer",D:"Recording Location",E:"During recording",F:"During performance",10:"Movie/video screen capture",11:"A bright coloured fish",12:"Illustration",13:"Band/artist logotype",14:"Publisher/Studio logotype"},o={AENC:"Audio encryption",APIC:"Attached picture",COMM:"Comments",COMR:"Commercial frame",ENCR:"Encryption method registration",EQUA:"Equalization",ETCO:"Event timing codes",GEOB:"General encapsulated object",GRID:"Group identification registration",IPLS:"Involved people list",LINK:"Linked information",MCDI:"Music CD identifier",MLLT:"MPEG location lookup table",OWNE:"Ownership frame",PRIV:"Private frame",PCNT:"Play counter",POPM:"Popularimeter",POSS:"Position synchronisation frame",RBUF:"Recommended buffer size",RVAD:"Relative volume adjustment",RVRB:"Reverb",SYLT:"Synchronized lyric/text",SYTC:"Synchronized tempo codes",TALB:"Album",TBPM:"BPM",TCOM:"Composer",TCON:"Genre",TCOP:"Copyright message",TDAT:"Date",TDLY:"Playlist delay",TENC:"Encoded by",TEXT:"Lyricist",TFLT:"File type",TIME:"Time",TIT1:"Content group description",TIT2:"Title",TIT3:"Subtitle",TKEY:"Initial key",TLAN:"Language(s)",TLEN:"Length",TMED:"Media type",TOAL:"Original album",TOFN:"Original filename",TOLY:"Original lyricist",TOPE:"Original artist",TORY:"Original release year",TOWN:"File owner",TPE1:"Artist",TPE2:"Band",TPE3:"Conductor",TPE4:"Interpreted, remixed, or otherwise modified by",TPOS:"Part of a set",TPUB:"Publisher",TRCK:"Track number",TRDA:"Recording dates",TRSN:"Internet radio station name",TRSO:"Internet radio station owner",TSIZ:"Size",TSRC:"ISRC (international standard recording code)",TSSE:"Software/Hardware and settings used for encoding",TYER:"Year",TXXX:"User defined text information frame",UFID:"Unique file identifier",USER:"Terms of use",USLT:"Lyrics",WCOM:"Commercial information",WCOP:"Copyright/Legal information",WOAF:"Official audio file webpage",WOAR:"Official artist/performer webpage",WOAS:"Official audio source webpage",WORS:"Official internet radio station homepage",WPAY:"Payment",WPUB:"Publishers official webpage",WXXX:"User defined URL link frame"},s={BUF:"RBUF",COM:"COMM",CRA:"AENC",EQU:"EQUA",ETC:"ETCO",GEO:"GEOB",MCI:"MCDI",MLL:"MLLT",PIC:"APIC",POP:"POPM",REV:"RVRB",RVA:"RVAD",SLT:"SYLT",STC:"SYTC",TAL:"TALB",TBP:"TBPM",TCM:"TCOM",TCO:"TCON",TCR:"TCOP",TDA:"TDAT",TDY:"TDLY",TEN:"TENC",TFT:"TFLT",TIM:"TIME",TKE:"TKEY",TLA:"TLAN",TLE:"TLEN",TMT:"TMED",TOA:"TOPE",TOF:"TOFN",TOL:"TOLY",TOR:"TORY",TOT:"TOAL",TP1:"TPE1",TP2:"TPE2",TP3:"TPE3",TP4:"TPE4",TPA:"TPOS",TPB:"TPUB",TRC:"TSRC",TRD:"TRDA",TRK:"TRCK",TSI:"TSIZ",TSS:"TSSE",TT1:"TIT1",TT2:"TIT2",TT3:"TIT3",TXT:"TEXT",TXX:"TXXX",TYE:"TYER",UFI:"UFID",ULT:"USLT",WAF:"WOAF",WAR:"WOAR",WAS:"WOAS",WCM:"WCOM",WCP:"WCOP",WPB:"WPB",WXX:"WXXX"},a={0:"Blues",1:"Classic Rock",2:"Country",3:"Dance",4:"Disco",5:"Funk",6:"Grunge",7:"Hip-Hop",8:"Jazz",9:"Metal",10:"New Age",11:"Oldies",12:"Other",13:"Pop",14:"R&B",15:"Rap",16:"Reggae",17:"Rock",18:"Techno",19:"Industrial",20:"Alternative",21:"Ska",22:"Death Metal",23:"Pranks",24:"Soundtrack",25:"Euro-Techno",26:"Ambient",27:"Trip-Hop",28:"Vocal",29:"Jazz+Funk",30:"Fusion",31:"Trance",32:"Classical",33:"Instrumental",34:"Acid",35:"House",36:"Game",37:"Sound Clip",38:"Gospel",39:"Noise",40:"AlternRock",41:"Bass",42:"Soul",43:"Punk",44:"Space",45:"Meditative",46:"Instrumental Pop",47:"Instrumental Rock",48:"Ethnic",49:"Gothic",50:"Darkwave",51:"Techno-Industrial",52:"Electronic",53:"Pop-Folk",54:"Eurodance",55:"Dream",56:"Southern Rock",57:"Comedy",58:"Cult",59:"Gangsta",60:"Top 40",61:"Christian Rap",62:"Pop/Funk",63:"Jungle",64:"Native American",65:"Cabaret",66:"New Wave",67:"Psychadelic",68:"Rave",69:"Showtunes",70:"Trailer",71:"Lo-Fi",72:"Tribal",73:"Acid Punk",74:"Acid Jazz",75:"Polka",76:"Retro",77:"Musical",78:"Rock & Roll",79:"Hard Rock",80:"Folk",81:"Folk-Rock",82:"National Folk",83:"Swing",84:"Fast Fusion",85:"Bebob",86:"Latin",87:"Revival",88:"Celtic",89:"Bluegrass",90:"Avantgarde",91:"Gothic Rock",92:"Progressive Rock",93:"Psychedelic Rock",94:"Symphonic Rock",95:"Slow Rock",96:"Big Band",97:"Chorus",98:"Easy Listening",99:"Acoustic",100:"Humour",101:"Speech",102:"Chanson",103:"Opera",104:"Chamber Music",105:"Sonata",106:"Symphony",107:"Booty Bass",108:"Primus",109:"Porn Groove",110:"Satire",111:"Slow Jam",112:"Club",113:"Tango",114:"Samba",115:"Folklore",116:"Ballad",117:"Power Ballad",118:"Rhythmic Soul",119:"Freestyle",120:"Duet",121:"Punk Rock",122:"Drum Solo",123:"A capella",124:"Euro-House",125:"Dance Hall"},u={pictures:[]},i=1/0;function c(e,t){n(e,t,i)}function d(e){for(var t,n,i,a,r,o,l,s="",u=0,c=e.length,d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";u<c;)a=(t=e.charCodeAt(u++))>>2,r=(3&t)<<4|(n=e.charCodeAt(u++))>>4,o=(15&n)<<2|(i=e.charCodeAt(u++))>>6,l=63&i,isNaN(n)?o=l=64:isNaN(i)&&(l=64),s=s+d.charAt(a)+d.charAt(r)+d.charAt(o)+d.charAt(l);return s}function m(e){var t=e.toString(2);return new Array(8-t.length+1).join("0")+t}  function p(e){if(4==e.length)if(3<u.revision){var t=e[0]<<21;t+=e[1]<<14,t+=e[2]<<7,t+=e[3]}else{t=e[0]<<24;t+=e[1]<<16,t+=e[2]<<8,t+=e[3]}else{t=e[0]<<16;t+=e[1]<<8,t+=e[2]}return t}var f={APIC:function(e,t,n){u.pictures.push(function(e){e.charCodeAt(0);var t=(e=e.substr(1)).indexOf("\0"),n=e.substr(0,t),i=(e=e.substr(t+1)).charCodeAt(0),a=l[i.toString(16).toUpperCase()],r=(e=e.substr(1)).indexOf("\0"),o=e.substr(0,r);return{dataURL:"data:"+n+";base64,"+d((e=e.substr(r+1)).split("").map(function(e){return String.fromCharCode(255&e.charCodeAt(0))}).join("")),PictureType:a,Description:o,MimeType:n}}(t))},PIC:function(e,t,n){u.pictures.push(function(e){e.charCodeAt(0);var t=(e=e.substr(1)).substr(0,3),n=(e=e.substr(3)).charCodeAt(0),i=l[n.toString(16).toUpperCase()],a=(e=e.substr(1)).indexOf("\0"),r=e.substr(0,a);return{dataURL:"data:img/"+t+";base64,"+d((e=e.substr(a+1)).split("").map(function(e){return String.fromCharCode(255&e.charCodeAt(0))}).join("")),PictureType:i,Description:r,MimeType:MimeType}}(t))},TLEN:function(e,t,n){var i,a,r,o;u.Length=(i=parseInt(h(t)),a=Math.floor(i/1e3),r=Math.floor(a/60),o=Math.floor(r/60),{milliseconds:i%1e3,seconds:a%60,minutes:r%60,hours:o%24,days:Math.floor(o/24)})},TCON:function(e,t,n){if(t=h(t),/\([0-9]+\)/.test(t))var i=a[parseInt(t.replace(/[\(\)]/g,""))];else i=t;u.Genre=i}};function g(){u.revision<3?c(3,function(e){if(console.log(e),/[A-Z0-9]{3}/.test(e)){var i,a,t=s[e.substr(0,3)];i=e,a=t,c(3,function(e,t){var n=p(t);c(n,function(e,t){"function"==typeof f[i]?f[i](n,e,t):"function"==typeof f[a]?f[a](n,e,t):o[a]?u[o[a]]=(u[o[a]]||"")+h(e):u[a]=h(e),console.log(u),g()})})}else r(u)}):c(4,function(e){var i;(console.log(e),/[A-Z0-9]{4}/.test(e))?(i=e,c(4,function(e,t){var n=p(t);c(2,function(e,t){t=m(t[0]).concat(m(t[1])),c(n,function(e,t){"function"==typeof f[i]?f[i](n,e,t):o[i]?u[o[i]]=(u[o[i]]||"")+h(e):u[i]=h(e),g()})})})):r(u)})}function h(e){if(0!=e.indexOf("http://")){e.charCodeAt(0);e=e.substr(1)}return e.replace(/[^A-Za-z0-9\(\)\{\}\[\]\!\@\#\$\%\^\&\* \/\"\'\;\>\<\?\,\~\`\.\n\t]/g,"")}return c(3,function(e){if("ID3"!=e)return r(u),!1;c(2,function(e,t){u.version="ID3v2."+t[0]+"."+t[1],u.revision=t[0],console.log("version",u.version),c(1,function(e,t){t=m(t[0]),c(4,function(e,t){i=p(t),c(0,function(){}),g()})})})}),u},parseURL:function(e,t){var n=new XMLHttpRequest;n.open("get",e,!0),n.overrideMimeType("text/plain; charset=x-user-defined");var i=0,a=0,r=function(){},o=1/0;var l="";return function(){if(n.responseText&&(l=n.responseText),n.responseText.length>o&&n.abort(),l.length>i+a&&a){var e=l.substr(i,a),t=e.split("").map(function(e){return 255&e.charCodeAt(0)});if(i+=a,a=0,!1===r(e,t))return n.abort()}setTimeout(arguments.callee,0)}(),n.send(null),[n,ID3v2.parseStream(function(e,t,n){r=t,o=n,0==(a=e)&&t("",[])},t)]},parseFile:function(e,t){var n=new FileReader;console.log(n);var i=0,a=0,r=function(){};var o="";return function(){if(n.result&&(o=n.result),o.length>i+a&&a){var e=o.substr(i,a),t=e.split("").map(function(e){return 255&e.charCodeAt(0)});if(i+=a,a=0,!1===r(e,t))return n.abort()}setTimeout(arguments.callee,0)}(),n.readAsBinaryString(e),[n,ID3v2.parseStream(function(e,t,n){r=t,n,0==(a=e)&&t("",[])},t)]},handleFiles:function(e,t){var n=0;!function(){ID3v2.parseFile(e[n],t),++n<e.length&&setTimeout(arguments.callee,5e3)}()},MP3Data:function(e){return{Pictures:e.pictures.length?e.pictures[0].dataURL:"",Title:e.Title||"",Album:e.Album||"",TrackNo:e["Track number"]||"",Artist:e.Artist||"",Genre:e.Genre||"",Duration:e.Length?[e.Length.minutes,e.Length.seconds].join(":"):"",Lyrics:e.Lyrics?e.Lyrics.substr(3):""}}};
